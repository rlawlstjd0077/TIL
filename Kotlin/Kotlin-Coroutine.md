# 코틀린, 코루틴 이해하기
### Task
- 운영체제 입장에서 동작시킬 방법은 두가지가 있음 
	- Process
		- 독립적인 메모리, 스택을 가지고 있는 상태에서 
	- Thread
		- 메모리는 공유하지만 스택은 독립적으로 가지고 있음
- 운영체제는 Task를 골라야 함
	- Task를 골라내는 것이 스케줄러임 
		- CPU 라는 공간을 어떻게 활용할 것이냐 인데 
		- Core 에 Task를 올려야 하고
	- 스케줄러는 실행, 대기 Task 큐를 가지고 있음
		- 큐 내부에는 우선순위를 가짐. 
	- 스케줄러는 특정한 룰을 가지고 Task
	- 선점
		- 기존에 돌던 Task를 중단시키고 새로운 Task를 넣는 것을 선점 방식이라고 함
	- 비선점
		- 기존에 선점되어 있다면 선점 시키지는 않고 협력적으로 동작시킬수 있는 라이브러리 개념의 기술을 의미함
### 프로그램
- 작성한 코드뭉치로 만들어짐. 
- 실행되지 않은 프로그램 (컴파일된 상태)
	- HDD, SSD 에 저장되어 있음 
	- 명령, 데이터, 기타 등등이 저장되어 있음
	- 가상머신인 경우 중간 언어로 만들어짐. 
- 예) 
	- Boot를 위한 (OS) 프로그램
- 실행되고 있는 프로그램
	- RAM (주기억장치) 으로 프로그램이 올라감 
	- 주기억 장치에서 CPU로 명령,
	- 레지스터에 명령들이 올라가 실행됨
	- RAM 상에 추가적으로 동적 메모리 (heap), 임시 메모리 (stack)이 할당된다. 
		- 실행중에 잡히는 객체는 heap
		- 지역 데이터들은 stack 
- 프로그램이 실행중인 순간
	- 명령어 한줄을 fetch 하여 CPU 에서 Process되는 것을 의미함
- CPU 
	- 코어가 1개
		- 멀티 프로세싱은 병렬 처리는 불가능함.
		- 하지만 동시에 실행되는 것처럼 보이는 동시성은 제공을 하는 것이다.
	- 코어가 2개
		- 병렬처리는 가능하며 프로세싱 성능이 올라감 

- Blocking Program
	- 여러 루틴이 순차적으로 이루어져 있기 때문에 순차적으로 코어에 하나씩 올라가서 처리가 됨
- Threading Program
	- 루틴 자체를 스레드로 만들었을 때 
	- 메모리 상에 heap 은 공유
	- Main Stack 하위에 스레드별 스택 공간이 존재함
	- 루틴이 각각 코어에 올라가서 처리되게 됨 (병렬처리가 되는 것임)
	- 스레드 루틴들이 실행되는 룰은 전적으로 OS 스케줄러가 결정함
	- 스케줄러는 우선순위에 따라서 기존에 실행되던 명령을 문맥 저장소로 보내 버리는데 이를 선점이라고 함 (보내진 명령은 선점 당함을 의미)
		- 이 변환 과정을 Context Switching이라고 함 
- 동시성 문제 (!!!!)
	- 스레드는 스케줄러에 의해서 인터럽트를 당할 수가 있다. 
	- 이때 인터럽트의 단위는 명령 한줄인데 이 명령은 코드한줄이 아니라 실제 어셈블리 명령 한줄을 의미함 
	- Atomic 이라는 개념이 등장하여 
- 동시성 <-> 병행성은 상반된 개념임 
- 협력형 태스크
	- 루틴들을 코루틴으로 만들었다고 가정
	- 보통 하나의 스레드에서 동작함 
		- Kotlin의 경우 Main Thread 하위에서 동작함 
		- 물론 별도 스레드로 동작시킬 수도 있음
	- 각각의 루틴은 코어내에서 Suspend, 재개다시 실행하면서 동시성을 가짐 
- Context Switching 
	- 프로세스의 경우 메모리 자체를 바꿔야 하기 때문에 비용큼
	- 스레드는 스택만 변경 필요
	- 코루틴은 스레드 하위에서 돌기 때문에 오버헤드가 전혀 없음
- 블로킹
	- 수행중인 루틴이 다른 요소에 의해서 실행이 중단되고 잠시 물러나는 상태
	- 코루틴은 루틴의 블로킹을 분리하고 비동기적으로 협력형 멀티태스크를 구현할 수 있게끔 하는 것이다. 
		- 내부에서는 코루틴 라이브러리가 담당하게 된다. 
- 코틀린 코루틴
	- 기본적으로 순차처리를 함 
	- 비동기를 원한다면 async 빌더를 사용하면 됨


질문
그럼 싱글코어에서 멀티 스레딩의 동시성 이슈는 없는가? 
- 중간에 인터럽트 당할 수 있기 때문에 문제가 있는 것인가 ?
- 인터럽트는 명령 단위로 발생할 수가 있다. !!!!!! 
	
Task 라고 불리는 이것은 명령어 한 줄을 의미 하는 것인가?
- 실제로 Core에는 어셈블리 코드만이 올라가는 것인가 ?

루틴의 정말 의미? 실제 개념?은 무엇일까 