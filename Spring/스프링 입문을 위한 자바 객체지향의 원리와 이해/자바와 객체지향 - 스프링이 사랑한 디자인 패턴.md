# 자바와 객체지향 - 스프링이 사랑한 디자인 패턴

출처: 스프링 입문을 위한 자바 객체 지향의 원리와 이해(김종민)

## 스프링이 사랑한 디자인 패턴

### ETC

- Service, Repository, Controller 등은 상태가 없거나 변화가 없는 빈이기 때문에 싱글톤으로 쓰기 적절하다.
  - Domain 객체들은 그렇지 않은 데 Spring에서 관리해줘야 하는 그 선을 정하는 것이 주요한 관건
- 가급적 상태 변화를 못하게 코드를 짜는 것이 좋다.
  - 생성자 주입을 써서 스프링을 걷어내도 돌아가도록 할 수 있음

### 디자인 패턴의 구현방식

- 디자인 패턴의 구현방식은 아래를 활용해서 구현이 된다.
  - 상속(extends)
  - 인터페이스(interface/implements)
  - 합성(다른 객체를 속성으로 가짐)
- 그렇기 때문에 결국에는 여러 패턴들이 비슷해 보인다.

### 어댑터 패턴

- 즉, Client가 원하는 규격과 Service가 제공하는 규격이 다를 때 변환기를 제공해서 S가 제공하는 규격을 C가 원하는 규격으로 변환해서 제공하는 것
- 예) 휴대폰을 충전하기 위해서 어댑터를 사용하여 접속할 수 있도록 한다.
- 업댑터를 만들게 되면서 Client가 다양한 서비스를 제공받을 수 있기 때문에 OCP 구조라고 볼 수도 있다.
- Spring의 PSA에서 강력하게 사용된다.
- 이미 제공되는 서비스(규격) 들이 여러가지가 있을 때 이를 사용되는 규격으로 쓸 수 있도록 서비스를 어댑터로 감싸서 사용하는 것
  - JDBC는 "먼저 규격을 만들고, JDBC Driver를 제공하기 때문에" 프록시 패턴과 가깝다.

### 프록시(대리자) 패턴

- S가 제공하는 규격에 별도의 로직을 처리해서 제공하고 싶을 때 사용한다.
- 제어 흐름을 조정하기 위한 목적으로 중간에 대리자를 두는 패턴
- 이해하기로는 어떠한 동작을 수행하는 서비스가 있을 때 같은 역할의 Proxy를 사용하되 어떠한 동작을 수행하되 수행 하는 중간에 추가적인 로직을 수행할 수 있는 방식
  - 반환 결과는 동일하지만 호출에 대한 흐름 제어가 주목적임
- 예제 코드
- 지연로딩, 캐쉬를 구현할 때 사용됨

### 데코레이터 패턴

- S가 제공하는 규격에 장식을 더해서 반환하고 싶을 때

  - 예) Output Stream을 사용할 때 별도 Stream 들을 하나씩 더해줄때

- 메서드 호출의 반환값에 변화를 주기 위해서 중간에 장식자를 두는 패턴

- 프록시 패턴과 구현방법이 같으나 

  반환값을 건드리냐 아니냐에 차이가 있음

  - 프록시 패턴: Spring의 트랜잭션 처리

- OCP / DIP 가 적용되어 있다 (?)

### 싱글톤 패턴

- 클래스의 인스턴스, 객체를 하나만 만들어서 사용하는 패턴
- 스프링의 DI에서 사용하며 스프링의 빈을 기본적으로 싱글톤으로 만들고 원한다면 프로토타입으로 만듬
  - 스프링은 99% 싱글톤을 사용함
  - 프로토타입 스콥은 거의 없음

### 템플릿 (견본) 메서드 패턴

- 상위 클래스의 견본 메서드에서 하위 클래스가 오버라이딩한 메서드를 호출하는 패턴(DIP)
- GK2 프로젝트에서 사용한 Controll 클래스 추상화가 바로 템플릿 메서드 패턴을 적용한 것임
  - 상위 클래스에서 반드시 하위 클래스에서 구현해야 하는 부분은 추상 메서드로 선언을 함
  - 상위 클래스에서 기본적으로 구현이 되어 있지만 하위 클래스에서 변경에 여지가 있는 기능은 메소드로 분리를 하고 Overriding 하여 사용하는 형식으로 사용

### 팩토리 메서드 패턴

- 오버라이드된 메서드가 객체를 반환하는 패턴
- 좀더 알아 봐야함
- DIP

### 전략 패턴 (패턴의 꽃)

- 클라언트가 전략을 생성해 전략을 실행할 컨텍스트에 주입하는 패턴
- 전략 패턴의 구성 요소
  - 컨텍스트
    - 예) 군인 - 제공된 무기들에 의해서 전략을 수행함
  - 전략
    - 예) 무기
  - 클라이언트
    - 예) 보급장교 - 전략을 선정하고 컨텍스트에 전달
- 스프링의 DI가 전략 패턴을 기반으로 하여 구현이 되어 있다.

### 템플릿 콜백(견본/회신) 패턴

- 전략을 익명 내부 클래스로 구현한 전략 패턴
- 굳이 구현 클래스를 구현할 필요 없이 인터페이스를 익명 클래스로 하여 Client에서 구현해서 넣는 것
- 스프링 DI가 실제로 사용하는 패턴임

### 그 밖의 스프링이 사랑한 다른 패턴

- Front Controller (최전방 제어자) 패턴
  - Dispatcher Servlet
- MVC 패턴
  - Model
  - View
  - Controller