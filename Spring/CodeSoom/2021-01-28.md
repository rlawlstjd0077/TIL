# 2020-01-28

# 배운 것

## 토비의 스프링 웹 MVC

### 웹 어플리케이션의 IoC 컨테이너 구선

- 자바에서는 프론트 컨트롤러 패턴이 적용되어 있음
  - ?
- 일반적인 웹 애플리케이션 구성
  - ?
  - ?
- 전체 애플리케이션에서 웹 기술에 의존적인 부분과 그렇지 않은 부분을 구분하기 위해서다.
- 웹 애플리케이션의 컨텍스트 구성 방법
  - ?
  - ?
  - ?
- 왜 그렇게 구성했나?
  - 독립적인 비즈니스 서비스 계층, 데이터 엑세스 계층을 담은 루트 애플리케이션 컨텍스트 - 서블릿  애플리케이션 컨텍스트
  - ?

## 스프링 웹 프레젠테이션 계층 기술

### 스프링 웹 프레임워크 종류

- 스프링 서블릿/ 스프링 MVC
  - 스프링이 직접 제공하는 서블릿  기반의 MVC 프레임워크
  - ? 을 핵심 엔진으로 사용한다.
  - 애노테이션 설정과 유연한 핸들러 메소드를 지원하는 ? 가 가장 대표적으로 사용되는 ? 기반의 기술이다.

### 스프링을 기반으로 두지 않는 웹 프레임워크

- JSP/Servlet
  - 기존에 만들어뒀던 모델 1방식의 JSP/서블릿을 스프링 애플리케이션의 웹 프레젠테이션 계층으로 사용할 수 있다.

### 스프링과 DispatcherServlet 전략

- 극한의 확장성을 추구하는 프레임워크
- 로드 존슨은 "항상 프레임워크 기반의 접근 방법을 사용하라" 고 조언한다.
  - 스프링을 잘 사용하는 비결은 유연한 확장성을 최대한 활용해서 두번째 스타일의 프레임워크를 지향하는 것
  - 예) @Autowired 애노테이션을 이용해서 의존관계를 설정할 수 있는 기능은 스프링 2.5에서 처음 등장했음
  - 기존 XML 설정 방식과는 크게 다른 획기적인 기능이 추가됬음에도 스프링의 IoC/DI 프레임워크의 기본 구조는 전혀 바뀌지 않았다.
- DispatcherServlet은 스프링의 웹 기술을 구성하는 다양한 전략을 DI로 구성해서 확장하도록 만들어진 스프링 서블릿/MVC의 엔진과 같은 역할을 한다.

### DispatcherServlet과 MVC 아키텍쳐

- 스프링 웹 기술은 ?를 근간으로 하고 있다.
  - M: ?를 담은 모델
  - V: ?로직을 담은 뷰
  - C: ?를 담은 컨트롤러
- MVC 아키텍처는 보통 ? 패턴과 함께 사용된다.
  - 중앙집중형 컨트롤러를 프레젠테이션 계층의 제일 앞에 둬서 서버로 들어오는 모든 요청을 받아서
  - 세부 컨트롤러로 작업을 위임해주고
  - 클라이언트에게 보낼 뷰를 선택해서 최종 결과를 생성하는 등의 작업을 수행
  - 예외가 발생했을 때 이를 일관된 방식으로 처리하는 것도 ?의 역할이다.
- `DispatcherServlet` = ?
- 스프링의 DispatcherServlet과 MVC의 관계
  - 함 그려보기

### HTTP 요청 접수 로직

1. DispatcherServlet의 HTTP 요청 입수

   - HTTP 프로토콜을 통해서 들어오는 요청이 ? 에 할당된 것이라면 HTTP요청 정보를 ?에 전달해준다.

   - ```
     DispatcherServlet
     ```

      은 모든 요청에 공통적으로 진행하야 하는 ? 작업이 등록된 것이 있다면 이를 먼저 수행한다.

     - 예를 들면 이용가능한 보안이나 ? 조작, ? 디코딩 과 같은 작업이 적용됨

2. DispatcherServlet에서 컨트롤러로 HTTP 요청 위임

   - `DispatcherServlet` 은 ?이나 파라미터 정보, HTTP 명령 등을 참고로 해서 어떤 컨트롤러에게 작업을 위임할지 결정한다.

   - 컨트롤러를 선정하는 방법은 `DispatcherServlet` ? 전략을 이용한다.

   - 스프링에서는 컨트롤러 = ? (**웹의 요청을 다루는 오브젝트 라는 뜻**)

   - 어떤 핸들러에게 작업을 위임할지를 결정해주는 것을 ? 매핑 전략이라고 한다.

     - 전략이라고 부르는 이유는 ???

   - 어떤 URL이 들어오면 어떤 컨트롤러 오브젝트가 이를 매핑해주는 전략을 만들어서 ?로 제공해주기만 하면 된다.

   - ```
     DispatcherServlet
     ```

      은 그 자체로 스프링 컨텍스트에 등록되는 빈이 아니므로 ? 가 일어나느 것은 아니다.

     - 하지만 ?DI가 적용되는 것처럼 ? 컨텍스트의 빈을 가져와 가사용한다.

   - `DispatcherServlet` 운 어떤 종류의 오브젝트라도 컨트롤러로 사용할 수 있다.

   - `DispatcherServlet`컨트롤러가 어떤 메소드를 가지고 어떤 인터페이스를 구현했는지는 알지 못한다.

   - 대신 컨트롤러의 종류에 따라 적절한 ?를 사용한다.

   - 어떤 ?를 사용할지는 `DispatcherServlet` 의 잔략의 하나인 ? 전략을 통해서 결정하며 이또한 DI를 통해 자유롭게 확장 가능하다.

3. 컨트롤러의 모델 생성과 정보 등록

   - MVC 패턴의 장점은 정보를 담고 있는 모델과 정보를 어떻게 뿌려줄지를 알고 있는 뷰가 분리된다는 점이다.
   - 컨트롤러의 작업은
     - 사용자 요청을 ? 하는 것
     - 그에따라 실제 ?를 수행하도록 서비스 계층 오브젝트에게 작업을 위임하는 것
     - 결과를 받아서 ?을 생성하는 것
     - 어떤 ?를 사용할지 결정하는 것
   - 모델을 생성하고 모델에 정보를 넣어주는 게 컨트톨러가 해야 할 마지막 중요한 두 가지 작업중 하나이다.
     - 컨트롤러가 어떤 식으로든 `DispatcherServlet` 에 돌려줘야 하는 두자기 정보가 모델, 뷰이다.
     - 모델은 보통 맵에 담긴 정보이며 복잡한 오브젝트 그래프를 갖는 컬렉션을 모델로 값으로 추가해도 상관없다.

4. 컨트롤러의 결과 리턴: 모델과 뷰

   - MVC의 모든 요소가 그렇듯 뷰도 하나의 오브젝트이다.

   - 컨트롤러가 뷰 오브젝트를 직접 리턴할 수도 있지만, 보통은 뷰의 논리적인 이름을 생성해주면 

     ```
     DispatcherServlet
     ```

      의 전략인 ?가 이를 이용해 뷰 오브젝트를 생성해준다.

     - 대표적으로 사용되는 뷰는 JSP/JSTL 뷰임
       - JSP (뷰 템플릿)
       - JSTL (JstlView 클래스로 만들어진 뷰 오브젝트)
     - **컨트롤러가 뷰에 대한 정보를 돌려준다는 개념**

   - 스프링에는 

     ```
     ModelAndView
     ```

      라는 이름의 오브젝트가 있다.

     - `DispatcherServlet` 이 최종적으로 어댑터를 통해 컨트롤러로부터 돌려받는 오브젝트이다.
     - **모델과 뷰를 넘기는 것으로 컨트롤러의 책임은 끝이다.**

5. `DispatcherServlet` 뷰 호출과

6. 모델 참조

   - `DispatcherServlet` 이 모델, 뷰를 받은 뒤 뷰 오브젝트에게 모델을 전달해주고 클라이언트에게 돌려줄 최종 결과물을 생성해달라고 요청한다.
   - 보통은 브라우저에서 나타날 HTML 을 생성하는 일이 가장 흔한 뷰의 작업이다.
     - JstlView 에서 컨트롤러가 돌려준 JSP 뷰 템플릿의 이름을 가져다 HTML을 생성한다.
     - 이때 동적으로 생성되도록 표시된 부분은 모델의 내용을 참고로 해서 내용을 채워주게 된다.
   - 뷰 작업을통한 최종 결과물은 `HttpServletResponse` 오브젝트 안에 담긴다.

7. HTTP 응답 돌려주기

   - `DispatcherServlet` 은 등록된 후처리기가 잇는지 확인하고, 있다면 후처리기에서 후속작업을 진행한 뒤에 뷰가 만들어준 `HttpServletResponse` 에 담긴 최종 결과를 서블릿 컨테이너에게 돌려준다.
   - 서블릿 컨테이너는 `HttpServletResponse` 에 담긴 정보를 ?응답으로 만들어 클라이언트에게 전송하고 작업을 종료한다.

### 정리

- ```
  DispatcherServlet
  ```

   을 프론트 컨트롤러로 사용하는 스프링 MVC의 가장 큰 특징은 매우 유연한 컨트롤러 호출 방식을 사용한다는 점이다.

  - 컨트롤러의 종류에 제약을 받지 않고 얼마든지 새로운 컨트롤러 타입을 추가하거나, 여러 가지 종류의 컨트롤러를 동시에 사용할 수도 있다.
  - 새로운 컨트롤러 타입을 적용하려면 `DispatcherServlet` 의 전략으로 추가할 수 있는 적절한 어댑터만 함께 제공해주면 된다.

### 뷰와 뷰, 뷰 이름, JSP 뷰(템플릿)

- 뷰라는 용어는 문맥에 따라 여러 가지 의미로 해석될 수 있다.

- 기본적으로 뷰는 MVC의 한 축인 뷰 컴포넌트를 의미한다.

  - 모델을 이용해 사용자에게 보여줄 내용을 만들어내는 역할을 통틀어 말하는 껏

  - 스프링 MVC에서는 

    ```
    View
    ```

     인터페이스를 구현해서 뷰 기능을 담당하는 다양한 클래스를 만들어서 사용한다.

    - `InternalResourceView` 가 대표적인 View 구현 클래스
    - 그래서 View는 `DispatcherServlet` 이 직접 사용하는 오브젝트를 가리키는 말이기도 함
    - 스프링 MVC 관점에서의 뷰는 바로 `View` 타입의 오브젝트를 의미함

  - JSP는 스프링 MVC 입장에서는 뷰가 아니다.

    - 뷰의 한가지인 `InternalResourceView` 가 활용하는 템플릿 파일일 뿐임
    - JSP가 뷰라고 부른느 이유는 ? 뿐만아니라 여타 MVC 프레임워크에서도 광범위하게 사용되는 뷰 기술이기 때문에